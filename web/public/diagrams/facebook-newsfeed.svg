<svg viewBox="0 0 1600 1000" xmlns="http://www.w3.org/2000/svg">
  <!-- Title -->
  <text x="800" y="30" font-size="24" font-weight="bold" text-anchor="middle" fill="#1a1a1a">
    Facebook News Feed Architecture
  </text>
  
  <!-- Client Layer -->
  <g id="client-layer">
    <rect x="50" y="60" width="300" height="180" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="5"/>
    <text x="200" y="85" font-size="14" font-weight="bold" text-anchor="middle" fill="#1976d2">Client Layer</text>
    
    <rect x="70" y="100" width="120" height="40" fill="#bbdefb" stroke="#1976d2" rx="3"/>
    <text x="130" y="125" font-size="12" text-anchor="middle">Mobile Apps</text>
    
    <rect x="210" y="100" width="120" height="40" fill="#bbdefb" stroke="#1976d2" rx="3"/>
    <text x="270" y="125" font-size="12" text-anchor="middle">Web Browser</text>
    
    <rect x="70" y="150" width="120" height="40" fill="#bbdefb" stroke="#1976d2" rx="3"/>
    <text x="130" y="175" font-size="12" text-anchor="middle">Desktop Apps</text>
    
    <rect x="210" y="150" width="120" height="40" fill="#bbdefb" stroke="#1976d2" rx="3"/>
    <text x="270" y="175" font-size="12" text-anchor="middle">API Clients</text>
  </g>
  
  <!-- API Gateway -->
  <g id="api-gateway">
    <rect x="450" y="60" width="300" height="180" fill="#fff3e0" stroke="#f57c00" stroke-width="2" rx="5"/>
    <text x="600" y="85" font-size="14" font-weight="bold" text-anchor="middle" fill="#f57c00">API Gateway</text>
    
    <rect x="470" y="100" width="120" height="40" fill="#ffe0b2" stroke="#f57c00" rx="3"/>
    <text x="530" y="125" font-size="12" text-anchor="middle">Rate Limiting</text>
    
    <rect x="610" y="100" width="120" height="40" fill="#ffe0b2" stroke="#f57c00" rx="3"/>
    <text x="670" y="125" font-size="12" text-anchor="middle">Authentication</text>
    
    <rect x="470" y="150" width="120" height="40" fill="#ffe0b2" stroke="#f57c00" rx="3"/>
    <text x="530" y="175" font-size="12" text-anchor="middle">Request Router</text>
    
    <rect x="610" y="150" width="120" height="40" fill="#ffe0b2" stroke="#f57c00" rx="3"/>
    <text x="670" y="175" font-size="12" text-anchor="middle">Protocol Handler</text>
  </g>
  
  <!-- CDN and Edge -->
  <g id="cdn-edge">
    <rect x="850" y="60" width="300" height="180" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2" rx="5"/>
    <text x="1000" y="85" font-size="14" font-weight="bold" text-anchor="middle" fill="#7b1fa2">CDN and Edge Cache</text>
    
    <rect x="870" y="100" width="120" height="40" fill="#e1bee7" stroke="#7b1fa2" rx="3"/>
    <text x="930" y="125" font-size="12" text-anchor="middle">Media CDN</text>
    
    <rect x="1010" y="100" width="120" height="40" fill="#e1bee7" stroke="#7b1fa2" rx="3"/>
    <text x="1070" y="125" font-size="12" text-anchor="middle">Static Assets</text>
    
    <rect x="870" y="150" width="120" height="40" fill="#e1bee7" stroke="#7b1fa2" rx="3"/>
    <text x="930" y="175" font-size="12" text-anchor="middle">Edge PoPs</text>
    
    <rect x="1010" y="150" width="120" height="40" fill="#e1bee7" stroke="#7b1fa2" rx="3"/>
    <text x="1070" y="175" font-size="12" text-anchor="middle">Regional Cache</text>
  </g>
  
  <!-- Real-time Layer -->
  <g id="realtime">
    <rect x="1250" y="60" width="300" height="180" fill="#e8f5e9" stroke="#388e3c" stroke-width="2" rx="5"/>
    <text x="1400" y="85" font-size="14" font-weight="bold" text-anchor="middle" fill="#388e3c">Real-time Infrastructure</text>
    
    <rect x="1270" y="100" width="120" height="40" fill="#c8e6c9" stroke="#388e3c" rx="3"/>
    <text x="1330" y="125" font-size="12" text-anchor="middle">WebSocket</text>
    
    <rect x="1410" y="100" width="120" height="40" fill="#c8e6c9" stroke="#388e3c" rx="3"/>
    <text x="1470" y="125" font-size="12" text-anchor="middle">Pub/Sub Kafka</text>
    
    <rect x="1270" y="150" width="120" height="40" fill="#c8e6c9" stroke="#388e3c" rx="3"/>
    <text x="1330" y="175" font-size="12" text-anchor="middle">Push Notify</text>
    
    <rect x="1410" y="150" width="120" height="40" fill="#c8e6c9" stroke="#388e3c" rx="3"/>
    <text x="1470" y="175" font-size="12" text-anchor="middle">Event Stream</text>
  </g>
  
  <!-- Feed Services -->
  <g id="feed-services">
    <rect x="50" y="290" width="400" height="200" fill="#fce4ec" stroke="#c2185b" stroke-width="2" rx="5"/>
    <text x="250" y="315" font-size="14" font-weight="bold" text-anchor="middle" fill="#c2185b">Feed Services</text>
    
    <rect x="70" y="330" width="160" height="40" fill="#f8bbd0" stroke="#c2185b" rx="3"/>
    <text x="150" y="350" font-size="11" text-anchor="middle">Feed Generator</text>
    <text x="150" y="363" font-size="9" text-anchor="middle" fill="#666">Orchestrates feed creation</text>
    
    <rect x="250" y="330" width="160" height="40" fill="#f8bbd0" stroke="#c2185b" rx="3"/>
    <text x="330" y="350" font-size="11" text-anchor="middle">Timeline Service</text>
    <text x="330" y="363" font-size="9" text-anchor="middle" fill="#666">Manages user timelines</text>
    
    <rect x="70" y="380" width="160" height="40" fill="#f8bbd0" stroke="#c2185b" rx="3"/>
    <text x="150" y="400" font-size="11" text-anchor="middle">Fanout Service</text>
    <text x="150" y="413" font-size="9" text-anchor="middle" fill="#666">Push model distribution</text>
    
    <rect x="250" y="380" width="160" height="40" fill="#f8bbd0" stroke="#c2185b" rx="3"/>
    <text x="330" y="400" font-size="11" text-anchor="middle">Story Service</text>
    <text x="330" y="413" font-size="9" text-anchor="middle" fill="#666">Ephemeral content</text>
    
    <rect x="160" y="430" width="160" height="40" fill="#f8bbd0" stroke="#c2185b" rx="3"/>
    <text x="240" y="450" font-size="11" text-anchor="middle">Notification Service</text>
    <text x="240" y="463" font-size="9" text-anchor="middle" fill="#666">Activity alerts</text>
  </g>
  
  <!-- Ranking and ML -->
  <g id="ranking-ml">
    <rect x="500" y="290" width="400" height="200" fill="#e1f5fe" stroke="#0288d1" stroke-width="2" rx="5"/>
    <text x="700" y="315" font-size="14" font-weight="bold" text-anchor="middle" fill="#0288d1">Ranking and ML Pipeline</text>
    
    <rect x="520" y="330" width="160" height="40" fill="#b3e5fc" stroke="#0288d1" rx="3"/>
    <text x="600" y="350" font-size="11" text-anchor="middle">Ranking Service</text>
    <text x="600" y="363" font-size="9" text-anchor="middle" fill="#666">ML-based scoring</text>
    
    <rect x="710" y="330" width="160" height="40" fill="#b3e5fc" stroke="#0288d1" rx="3"/>
    <text x="790" y="350" font-size="11" text-anchor="middle">Feature Extraction</text>
    <text x="790" y="363" font-size="9" text-anchor="middle" fill="#666">100+ ranking signals</text>
    
    <rect x="520" y="380" width="160" height="40" fill="#b3e5fc" stroke="#0288d1" rx="3"/>
    <text x="600" y="400" font-size="11" text-anchor="middle">Model Serving</text>
    <text x="600" y="413" font-size="9" text-anchor="middle" fill="#666">Inference engine</text>
    
    <rect x="710" y="380" width="160" height="40" fill="#b3e5fc" stroke="#0288d1" rx="3"/>
    <text x="790" y="400" font-size="11" text-anchor="middle">A/B Testing</text>
    <text x="790" y="413" font-size="9" text-anchor="middle" fill="#666">Experimentation</text>
    
    <rect x="610" y="430" width="160" height="40" fill="#b3e5fc" stroke="#0288d1" rx="3"/>
    <text x="690" y="450" font-size="11" text-anchor="middle">Real-time Training</text>
    <text x="690" y="463" font-size="9" text-anchor="middle" fill="#666">Model updates</text>
  </g>
  
  <!-- Content Processing -->
  <g id="content-processing">
    <rect x="950" y="290" width="400" height="200" fill="#fff8e1" stroke="#ffa000" stroke-width="2" rx="5"/>
    <text x="1150" y="315" font-size="14" font-weight="bold" text-anchor="middle" fill="#ffa000">Content Processing</text>
    
    <rect x="970" y="330" width="160" height="40" fill="#ffecb3" stroke="#ffa000" rx="3"/>
    <text x="1050" y="350" font-size="11" text-anchor="middle">Media Service</text>
    <text x="1050" y="363" font-size="9" text-anchor="middle" fill="#666">Photo/video processing</text>
    
    <rect x="1160" y="330" width="160" height="40" fill="#ffecb3" stroke="#ffa000" rx="3"/>
    <text x="1240" y="350" font-size="11" text-anchor="middle">Content Understanding</text>
    <text x="1240" y="363" font-size="9" text-anchor="middle" fill="#666">NLP/Computer Vision</text>
    
    <rect x="970" y="380" width="160" height="40" fill="#ffecb3" stroke="#ffa000" rx="3"/>
    <text x="1050" y="400" font-size="11" text-anchor="middle">Privacy Checker</text>
    <text x="1050" y="413" font-size="9" text-anchor="middle" fill="#666">Access control</text>
    
    <rect x="1160" y="380" width="160" height="40" fill="#ffecb3" stroke="#ffa000" rx="3"/>
    <text x="1240" y="400" font-size="11" text-anchor="middle">Spam Detection</text>
    <text x="1240" y="413" font-size="9" text-anchor="middle" fill="#666">Abuse prevention</text>
    
    <rect x="1060" y="430" width="160" height="40" fill="#ffecb3" stroke="#ffa000" rx="3"/>
    <text x="1140" y="450" font-size="11" text-anchor="middle">Ad Insertion</text>
    <text x="1140" y="463" font-size="9" text-anchor="middle" fill="#666">Sponsored content</text>
  </g>
  
  <!-- Cache Layer -->
  <g id="cache-layer">
    <rect x="50" y="540" width="300" height="180" fill="#ffebee" stroke="#d32f2f" stroke-width="2" rx="5"/>
    <text x="200" y="565" font-size="14" font-weight="bold" text-anchor="middle" fill="#d32f2f">Cache Infrastructure</text>
    
    <rect x="70" y="580" width="120" height="40" fill="#ffcdd2" stroke="#d32f2f" rx="3"/>
    <text x="130" y="600" font-size="11" text-anchor="middle">Memcached</text>
    <text x="130" y="613" font-size="9" text-anchor="middle" fill="#666">Feed cache</text>
    
    <rect x="210" y="580" width="120" height="40" fill="#ffcdd2" stroke="#d32f2f" rx="3"/>
    <text x="270" y="600" font-size="11" text-anchor="middle">Redis Cluster</text>
    <text x="270" y="613" font-size="9" text-anchor="middle" fill="#666">Session/hot data</text>
    
    <rect x="70" y="630" width="120" height="40" fill="#ffcdd2" stroke="#d32f2f" rx="3"/>
    <text x="130" y="650" font-size="11" text-anchor="middle">TAO Cache</text>
    <text x="130" y="663" font-size="9" text-anchor="middle" fill="#666">Graph cache</text>
    
    <rect x="210" y="630" width="120" height="40" fill="#ffcdd2" stroke="#d32f2f" rx="3"/>
    <text x="270" y="650" font-size="11" text-anchor="middle">Feature Cache</text>
    <text x="270" y="663" font-size="9" text-anchor="middle" fill="#666">ML features</text>
  </g>
  
  <!-- Timeline Storage -->
  <g id="timeline-storage">
    <rect x="400" y="540" width="300" height="180" fill="#e8eaf6" stroke="#5e35b1" stroke-width="2" rx="5"/>
    <text x="550" y="565" font-size="14" font-weight="bold" text-anchor="middle" fill="#5e35b1">Timeline Storage</text>
    
    <rect x="420" y="580" width="120" height="40" fill="#d1c4e9" stroke="#5e35b1" rx="3"/>
    <text x="480" y="600" font-size="11" text-anchor="middle">RocksDB</text>
    <text x="480" y="613" font-size="9" text-anchor="middle" fill="#666">Pre-computed feeds</text>
    
    <rect x="560" y="580" width="120" height="40" fill="#d1c4e9" stroke="#5e35b1" rx="3"/>
    <text x="620" y="600" font-size="11" text-anchor="middle">Cassandra</text>
    <text x="620" y="613" font-size="9" text-anchor="middle" fill="#666">Distributed timelines</text>
    
    <rect x="420" y="630" width="120" height="40" fill="#d1c4e9" stroke="#5e35b1" rx="3"/>
    <text x="480" y="650" font-size="11" text-anchor="middle">Timeline Index</text>
    <text x="480" y="663" font-size="9" text-anchor="middle" fill="#666">Post references</text>
    
    <rect x="560" y="630" width="120" height="40" fill="#d1c4e9" stroke="#5e35b1" rx="3"/>
    <text x="620" y="650" font-size="11" text-anchor="middle">Sharding Manager</text>
    <text x="620" y="663" font-size="9" text-anchor="middle" fill="#666">User-based shards</text>
  </g>
  
  <!-- Primary Storage -->
  <g id="primary-storage">
    <rect x="750" y="540" width="300" height="180" fill="#e0f2f1" stroke="#00796b" stroke-width="2" rx="5"/>
    <text x="900" y="565" font-size="14" font-weight="bold" text-anchor="middle" fill="#00796b">Primary Storage</text>
    
    <rect x="770" y="580" width="120" height="40" fill="#b2dfdb" stroke="#00796b" rx="3"/>
    <text x="830" y="600" font-size="11" text-anchor="middle">MySQL Cluster</text>
    <text x="830" y="613" font-size="9" text-anchor="middle" fill="#666">User/post metadata</text>
    
    <rect x="910" y="580" width="120" height="40" fill="#b2dfdb" stroke="#00796b" rx="3"/>
    <text x="970" y="600" font-size="11" text-anchor="middle">TAO Graph DB</text>
    <text x="970" y="613" font-size="9" text-anchor="middle" fill="#666">Social graph</text>
    
    <rect x="770" y="630" width="120" height="40" fill="#b2dfdb" stroke="#00796b" rx="3"/>
    <text x="830" y="650" font-size="11" text-anchor="middle">Haystack</text>
    <text x="830" y="663" font-size="9" text-anchor="middle" fill="#666">Photo storage</text>
    
    <rect x="910" y="630" width="120" height="40" fill="#b2dfdb" stroke="#00796b" rx="3"/>
    <text x="970" y="650" font-size="11" text-anchor="middle">F4 Storage</text>
    <text x="970" y="663" font-size="9" text-anchor="middle" fill="#666">Cold storage</text>
  </g>
  
  <!-- Analytics -->
  <g id="analytics">
    <rect x="1100" y="540" width="300" height="180" fill="#ffeaa7" stroke="#fdcb6e" stroke-width="2" rx="5"/>
    <text x="1250" y="565" font-size="14" font-weight="bold" text-anchor="middle" fill="#d63031">Analytics and Monitoring</text>
    
    <rect x="1120" y="580" width="120" height="40" fill="#ffecc7" stroke="#fdcb6e" rx="3"/>
    <text x="1180" y="600" font-size="11" text-anchor="middle">Scribe</text>
    <text x="1180" y="613" font-size="9" text-anchor="middle" fill="#666">Log aggregation</text>
    
    <rect x="1260" y="580" width="120" height="40" fill="#ffecc7" stroke="#fdcb6e" rx="3"/>
    <text x="1320" y="600" font-size="11" text-anchor="middle">Presto</text>
    <text x="1320" y="613" font-size="9" text-anchor="middle" fill="#666">Analytics queries</text>
    
    <rect x="1120" y="630" width="120" height="40" fill="#ffecc7" stroke="#fdcb6e" rx="3"/>
    <text x="1180" y="650" font-size="11" text-anchor="middle">DataDog</text>
    <text x="1180" y="663" font-size="9" text-anchor="middle" fill="#666">Metrics/monitoring</text>
    
    <rect x="1260" y="630" width="120" height="40" fill="#ffecc7" stroke="#fdcb6e" rx="3"/>
    <text x="1320" y="650" font-size="11" text-anchor="middle">Hive DW</text>
    <text x="1320" y="663" font-size="9" text-anchor="middle" fill="#666">Data warehouse</text>
  </g>
  
  <!-- Data Flow Arrows -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
    </marker>
  </defs>
  
  <!-- Connection arrows -->
  <path d="M 350 150 L 450 150" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <path d="M 750 150 L 850 150" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <path d="M 600 240 L 600 290" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <path d="M 1000 240 L 1000 290" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <path d="M 1400 240 L 1400 290" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <path d="M 250 490 L 250 540" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <path d="M 700 490 L 700 540" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <path d="M 1150 490 L 1150 540" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <path d="M 200 720 L 550 720" stroke="#666" stroke-width="1" stroke-dasharray="5,5"/>
  <path d="M 550 720 L 900 720" stroke="#666" stroke-width="1" stroke-dasharray="5,5"/>
  <path d="M 900 720 L 1250 720" stroke="#666" stroke-width="1" stroke-dasharray="5,5"/>
  
  <!-- Info Boxes -->
  <g id="info-boxes">
    <rect x="50" y="780" width="200" height="150" fill="#f5f5f5" stroke="#999" stroke-width="1" rx="3"/>
    <text x="60" y="800" font-size="12" font-weight="bold" fill="#333">Feed Generation Models:</text>
    <text x="60" y="820" font-size="10" fill="#555">• Push: Pre-computed feeds</text>
    <text x="60" y="835" font-size="10" fill="#555">• Pull: On-demand generation</text>
    <text x="60" y="850" font-size="10" fill="#555">• Hybrid: Push for regular users</text>
    <text x="60" y="865" font-size="10" fill="#555">  Pull for celebrities</text>
    <text x="60" y="885" font-size="10" fill="#555">Timeline Types:</text>
    <text x="60" y="900" font-size="10" fill="#555">• Home: Friends + Pages</text>
    <text x="60" y="915" font-size="10" fill="#555">• Discover: Recommended</text>
    
    <rect x="300" y="780" width="200" height="150" fill="#f5f5f5" stroke="#999" stroke-width="1" rx="3"/>
    <text x="310" y="800" font-size="12" font-weight="bold" fill="#333">Scale Metrics:</text>
    <text x="310" y="820" font-size="10" fill="#555">• 3B total users</text>
    <text x="310" y="835" font-size="10" fill="#555">• 1.5B daily active users</text>
    <text x="310" y="850" font-size="10" fill="#555">• 500K posts/second peak</text>
    <text x="310" y="865" font-size="10" fill="#555">• 100B ranking queries/day</text>
    <text x="310" y="885" font-size="10" fill="#555">Performance:</text>
    <text x="310" y="900" font-size="10" fill="#555">• Feed latency: 200ms</text>
    <text x="310" y="915" font-size="10" fill="#555">• Real-time updates: 100ms</text>
    
    <rect x="550" y="780" width="200" height="150" fill="#f5f5f5" stroke="#999" stroke-width="1" rx="3"/>
    <text x="560" y="800" font-size="12" font-weight="bold" fill="#333">Ranking Signals:</text>
    <text x="560" y="820" font-size="10" fill="#555">• User affinity score</text>
    <text x="560" y="835" font-size="10" fill="#555">• Content engagement</text>
    <text x="560" y="850" font-size="10" fill="#555">• Time decay factor</text>
    <text x="560" y="865" font-size="10" fill="#555">• Device/connection type</text>
    <text x="560" y="880" font-size="10" fill="#555">• Social proof signals</text>
    <text x="560" y="895" font-size="10" fill="#555">• Content quality score</text>
    <text x="560" y="910" font-size="10" fill="#555">• 100+ total features</text>
    
    <rect x="800" y="780" width="200" height="150" fill="#f5f5f5" stroke="#999" stroke-width="1" rx="3"/>
    <text x="810" y="800" font-size="12" font-weight="bold" fill="#333">Storage Strategy:</text>
    <text x="810" y="820" font-size="10" fill="#555">• MySQL: User/post metadata</text>
    <text x="810" y="835" font-size="10" fill="#555">• TAO: Social graph edges</text>
    <text x="810" y="850" font-size="10" fill="#555">• Cassandra: Timelines</text>
    <text x="810" y="865" font-size="10" fill="#555">• Haystack: Photos</text>
    <text x="810" y="880" font-size="10" fill="#555">• RocksDB: Feed cache</text>
    <text x="810" y="895" font-size="10" fill="#555">• Memcached: Hot data</text>
    <text x="810" y="910" font-size="10" fill="#555">• F4: Cold storage</text>
    
    <rect x="1050" y="780" width="200" height="150" fill="#f5f5f5" stroke="#999" stroke-width="1" rx="3"/>
    <text x="1060" y="800" font-size="12" font-weight="bold" fill="#333">Caching Layers:</text>
    <text x="1060" y="820" font-size="10" fill="#555">L1: Browser cache</text>
    <text x="1060" y="835" font-size="10" fill="#555">L2: CDN edge cache</text>
    <text x="1060" y="850" font-size="10" fill="#555">L3: Regional cache</text>
    <text x="1060" y="865" font-size="10" fill="#555">L4: Service cache</text>
    <text x="1060" y="880" font-size="10" fill="#555">L5: Database cache</text>
    <text x="1060" y="900" font-size="10" fill="#555">Cache Hit Ratio: 95%+</text>
    <text x="1060" y="915" font-size="10" fill="#555">TTL: 5min - 24hrs</text>
    
    <rect x="1300" y="780" width="250" height="150" fill="#f5f5f5" stroke="#999" stroke-width="1" rx="3"/>
    <text x="1310" y="800" font-size="12" font-weight="bold" fill="#333">Key Design Decisions:</text>
    <text x="1310" y="820" font-size="10" fill="#555">• Hybrid push/pull for scalability</text>
    <text x="1310" y="835" font-size="10" fill="#555">• ML-based ranking vs chronological</text>
    <text x="1310" y="850" font-size="10" fill="#555">• Sharded storage with denormalization</text>
    <text x="1310" y="865" font-size="10" fill="#555">• WebSockets for real-time updates</text>
    <text x="1310" y="880" font-size="10" fill="#555">• Microservices architecture</text>
    <text x="1310" y="895" font-size="10" fill="#555">• Progressive enhancement</text>
    <text x="1310" y="910" font-size="10" fill="#555">• Multi-region deployment</text>
  </g>
</svg>