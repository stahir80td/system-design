<svg viewBox="0 0 1400 900" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect width="1400" height="900" fill="#f5f7fa"/>
  
  <!-- Title -->
  <text x="700" y="35" font-size="26" font-weight="bold" text-anchor="middle" fill="#1a1a1a">Uber/Lyft Ride Sharing Architecture</text>
  
  <!-- Client Apps -->
  <g id="clients">
    <rect x="50" y="100" width="120" height="60" rx="5" fill="#000000" />
    <text x="110" y="130" text-anchor="middle" fill="white" font-size="14">Rider App</text>
    <text x="110" y="150" text-anchor="middle" fill="#999" font-size="11">(iOS/Android)</text>
    
    <rect x="50" y="180" width="120" height="60" rx="5" fill="#000000" />
    <text x="110" y="210" text-anchor="middle" fill="white" font-size="14">Driver App</text>
    <text x="110" y="230" text-anchor="middle" fill="#999" font-size="11">(iOS/Android)</text>
  </g>
  
  <!-- API Gateway -->
  <rect x="250" y="140" width="120" height="60" rx="5" fill="#FF5722" />
  <text x="310" y="170" text-anchor="middle" fill="white" font-size="14">API Gateway</text>
  <text x="310" y="190" text-anchor="middle" fill="#fff" font-size="11">(Auth/Routing)</text>
  
  <!-- Load Balancer -->
  <rect x="430" y="140" width="120" height="60" rx="5" fill="#795548" />
  <text x="490" y="175" text-anchor="middle" fill="white" font-size="14">Load Balancer</text>
  
  <!-- Core Services Layer -->
  <g id="services">
    <!-- Location Service -->
    <rect x="630" y="80" width="130" height="60" rx="5" fill="#4CAF50" />
    <text x="695" y="110" text-anchor="middle" fill="white" font-size="14">Location</text>
    <text x="695" y="130" text-anchor="middle" fill="white" font-size="14">Service</text>
    
    <!-- Matching Service -->
    <rect x="780" y="80" width="130" height="60" rx="5" fill="#2196F3" />
    <text x="845" y="110" text-anchor="middle" fill="white" font-size="14">Matching</text>
    <text x="845" y="130" text-anchor="middle" fill="white" font-size="14">Service</text>
    
    <!-- Trip Service -->
    <rect x="930" y="80" width="130" height="60" rx="5" fill="#9C27B0" />
    <text x="995" y="110" text-anchor="middle" fill="white" font-size="14">Trip</text>
    <text x="995" y="130" text-anchor="middle" fill="white" font-size="14">Service</text>
    
    <!-- Pricing Service -->
    <rect x="630" y="160" width="130" height="60" rx="5" fill="#FF9800" />
    <text x="695" y="190" text-anchor="middle" fill="white" font-size="14">Pricing</text>
    <text x="695" y="210" text-anchor="middle" fill="white" font-size="14">Service</text>
    
    <!-- Payment Service -->
    <rect x="780" y="160" width="130" height="60" rx="5" fill="#009688" />
    <text x="845" y="190" text-anchor="middle" fill="white" font-size="14">Payment</text>
    <text x="845" y="210" text-anchor="middle" fill="white" font-size="14">Service</text>
    
    <!-- Notification Service -->
    <rect x="930" y="160" width="130" height="60" rx="5" fill="#607D8B" />
    <text x="995" y="190" text-anchor="middle" fill="white" font-size="14">Notification</text>
    <text x="995" y="210" text-anchor="middle" fill="white" font-size="14">Service</text>
  </g>
  
  <!-- WebSocket Server -->
  <rect x="1120" y="120" width="130" height="60" rx="5" fill="#3F51B5" />
  <text x="1185" y="150" text-anchor="middle" fill="white" font-size="14">WebSocket</text>
  <text x="1185" y="170" text-anchor="middle" fill="white" font-size="11">(Real-time)</text>
  
  <!-- Message Queue -->
  <rect x="730" y="280" width="130" height="60" rx="5" fill="#E91E63" />
  <text x="795" y="310" text-anchor="middle" fill="white" font-size="14">Kafka</text>
  <text x="795" y="330" text-anchor="middle" fill="white" font-size="11">(Event Stream)</text>
  
  <!-- Data Storage Layer -->
  <g id="databases">
    <!-- PostgreSQL -->
    <rect x="250" y="420" width="140" height="70" rx="5" fill="#336791" />
    <text x="320" y="450" text-anchor="middle" fill="white" font-size="14">PostgreSQL</text>
    <text x="320" y="470" text-anchor="middle" fill="white" font-size="12">(Users/Trips)</text>
    
    <!-- Redis Geo -->
    <rect x="420" y="420" width="140" height="70" rx="5" fill="#DC382D" />
    <text x="490" y="450" text-anchor="middle" fill="white" font-size="14">Redis Geo</text>
    <text x="490" y="470" text-anchor="middle" fill="white" font-size="12">(Live Locations)</text>
    
    <!-- Cassandra -->
    <rect x="590" y="420" width="140" height="70" rx="5" fill="#1287B0" />
    <text x="660" y="450" text-anchor="middle" fill="white" font-size="14">Cassandra</text>
    <text x="660" y="470" text-anchor="middle" fill="white" font-size="12">(Location History)</text>
    
    <!-- ElasticSearch -->
    <rect x="760" y="420" width="140" height="70" rx="5" fill="#00BCD4" />
    <text x="830" y="450" text-anchor="middle" fill="white" font-size="14">ElasticSearch</text>
    <text x="830" y="470" text-anchor="middle" fill="white" font-size="12">(Analytics)</text>
    
    <!-- S3 Storage -->
    <rect x="930" y="420" width="140" height="70" rx="5" fill="#FF9900" />
    <text x="1000" y="450" text-anchor="middle" fill="white" font-size="14">S3 Storage</text>
    <text x="1000" y="470" text-anchor="middle" fill="white" font-size="12">(Documents)</text>
  </g>
  
  <!-- Geospatial Index -->
  <rect x="490" y="280" width="140" height="60" rx="5" fill="#8BC34A" />
  <text x="560" y="310" text-anchor="middle" fill="white" font-size="14">Geohash Index</text>
  <text x="560" y="330" text-anchor="middle" fill="white" font-size="11">(Spatial Queries)</text>
  
  <!-- ML Platform -->
  <rect x="970" y="280" width="140" height="60" rx="5" fill="#673AB7" />
  <text x="1040" y="310" text-anchor="middle" fill="white" font-size="14">ML Platform</text>
  <text x="1040" y="330" text-anchor="middle" fill="white" font-size="11">(ETA/Demand)</text>
  
  <!-- External Services -->
  <g id="external">
    <rect x="1200" y="420" width="120" height="60" rx="5" fill="#757575" />
    <text x="1260" y="450" text-anchor="middle" fill="white" font-size="14">Maps API</text>
    <text x="1260" y="470" text-anchor="middle" fill="white" font-size="11">(Google/Mapbox)</text>
    
    <rect x="1200" y="500" width="120" height="60" rx="5" fill="#4285F4" />
    <text x="1260" y="530" text-anchor="middle" fill="white" font-size="14">Payment</text>
    <text x="1260" y="550" text-anchor="middle" fill="white" font-size="11">(Stripe/Braintree)</text>
  </g>
  
  <!-- Connection Lines -->
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333" />
    </marker>
  </defs>
  
  <!-- Client to Gateway -->
  <line x1="170" y1="130" x2="250" y2="160" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
  <line x1="170" y1="210" x2="250" y2="180" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
  
  <!-- Gateway to Load Balancer -->
  <line x1="370" y1="170" x2="430" y2="170" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
  
  <!-- Load Balancer to Services -->
  <line x1="550" y1="170" x2="630" y2="110" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
  <line x1="550" y1="170" x2="780" y2="110" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
  <line x1="550" y1="170" x2="930" y2="110" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
  
  <!-- Services to WebSocket -->
  <line x1="1060" y1="110" x2="1120" y2="150" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
  
  <!-- Services to Kafka -->
  <line x1="695" y1="140" x2="760" y2="280" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
  <line x1="845" y1="140" x2="800" y2="280" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
  <line x1="995" y1="140" x2="830" y2="280" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
  
  <!-- Services to Databases -->
  <line x1="695" y1="140" x2="490" y2="420" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
  <line x1="845" y1="140" x2="320" y2="420" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
  <line x1="995" y1="140" x2="660" y2="420" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
  
  <!-- Geospatial to Redis -->
  <line x1="530" y1="340" x2="490" y2="420" stroke="#333" stroke-width="2" marker-end="url(#arrow)" />
  
  <!-- ML to Services -->
  <line x1="1040" y1="280" x2="845" y2="140" stroke="#333" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrow)" />
  
  <!-- External Services -->
  <line x1="695" y1="140" x2="1200" y2="450" stroke="#333" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrow)" />
  <line x1="845" y1="220" x2="1200" y2="530" stroke="#333" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrow)" />
  
  <!-- Legend -->
  <g transform="translate(50, 600)">
    <text x="0" y="0" font-size="16" font-weight="bold" fill="#333">Legend:</text>
    
    <rect x="0" y="10" width="40" height="20" fill="#000"/>
    <text x="50" y="25" font-size="12" fill="#666">Client Applications</text>
    
    <rect x="0" y="40" width="40" height="20" fill="#4CAF50"/>
    <text x="50" y="55" font-size="12" fill="#666">Core Services</text>
    
    <rect x="0" y="70" width="40" height="20" fill="#336791"/>
    <text x="50" y="85" font-size="12" fill="#666">Data Storage</text>
    
    <line x1="0" y1="110" x2="40" y2="110" stroke="#333" stroke-width="2" />
    <text x="50" y="115" font-size="12" fill="#666">Synchronous</text>
    
    <line x1="0" y1="130" x2="40" y2="130" stroke="#333" stroke-width="2" stroke-dasharray="5,5" />
    <text x="50" y="135" font-size="12" fill="#666">Asynchronous</text>
  </g>
  
  <!-- Key Flows -->
  <g transform="translate(50, 770)">
    <text x="0" y="0" font-size="14" font-weight="bold" fill="#333">Key System Flows:</text>
    <text x="0" y="25" font-size="12" fill="#666">1. Ride Request: Rider App → API Gateway → Trip Service → Matching Service → Location Service</text>
    <text x="0" y="45" font-size="12" fill="#666">2. Driver Matching: Matching Service → Geohash Index → Redis Geo → Find Nearby Drivers</text>
    <text x="0" y="65" font-size="12" fill="#666">3. Live Tracking: Driver App → Location Service → WebSocket → Rider App (Real-time updates)</text>
    <text x="0" y="85" font-size="12" fill="#666">4. Surge Pricing: Pricing Service → ML Platform → Calculate Supply/Demand → Dynamic Multiplier</text>
    <text x="0" y="105" font-size="12" fill="#666">5. Payment: Trip Complete → Payment Service → Stripe API → Process Payment → Driver Payout</text>
  </g>
</svg>