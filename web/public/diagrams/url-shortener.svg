<svg viewBox="0 0 1200 800" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect width="1200" height="800" fill="#f8f9fa"/>
  
  <!-- Title -->
  <text x="600" y="30" font-size="24" font-weight="bold" text-anchor="middle" fill="#1a1a1a">URL Shortener System Architecture</text>
  
  <!-- Client -->
  <rect x="50" y="100" width="120" height="60" rx="5" fill="#4285f4" />
  <text x="110" y="135" text-anchor="middle" fill="white" font-size="14">Client</text>
  
  <!-- CDN -->
  <rect x="250" y="100" width="120" height="60" rx="5" fill="#34a853" />
  <text x="310" y="135" text-anchor="middle" fill="white" font-size="14">CDN</text>
  <text x="310" y="180" text-anchor="middle" fill="#666" font-size="11">(CloudFlare)</text>
  
  <!-- Load Balancer -->
  <rect x="450" y="100" width="120" height="60" rx="5" fill="#fbbc04" />
  <text x="510" y="135" text-anchor="middle" fill="white" font-size="14">Load Balancer</text>
  <text x="510" y="180" text-anchor="middle" fill="#666" font-size="11">(NGINX)</text>
  
  <!-- API Gateway -->
  <rect x="650" y="100" width="120" height="60" rx="5" fill="#ea4335" />
  <text x="710" y="135" text-anchor="middle" fill="white" font-size="14">API Gateway</text>
  <text x="710" y="180" text-anchor="middle" fill="#666" font-size="11">(Rate Limiting)</text>
  
  <!-- App Servers -->
  <g>
    <rect x="350" y="250" width="120" height="60" rx="5" fill="#5f6368" />
    <text x="410" y="285" text-anchor="middle" fill="white" font-size="14">App Server 1</text>
    
    <rect x="500" y="250" width="120" height="60" rx="5" fill="#5f6368" />
    <text x="560" y="285" text-anchor="middle" fill="white" font-size="14">App Server 2</text>
    
    <rect x="650" y="250" width="120" height="60" rx="5" fill="#5f6368" />
    <text x="710" y="285" text-anchor="middle" fill="white" font-size="14">App Server N</text>
  </g>
  
  <!-- Cache Layer -->
  <rect x="250" y="380" width="150" height="60" rx="5" fill="#db4437" />
  <text x="325" y="415" text-anchor="middle" fill="white" font-size="14">Redis Cache</text>
  <text x="325" y="460" text-anchor="middle" fill="#666" font-size="11">(Hot URLs)</text>
  
  <!-- Database -->
  <rect x="450" y="380" width="150" height="60" rx="5" fill="#0f9d58" />
  <text x="525" y="415" text-anchor="middle" fill="white" font-size="14">Primary DB</text>
  <text x="525" y="460" text-anchor="middle" fill="#666" font-size="11">(PostgreSQL)</text>
  
  <!-- Read Replicas -->
  <rect x="650" y="380" width="150" height="60" rx="5" fill="#0f9d58" opacity="0.7" />
  <text x="725" y="415" text-anchor="middle" fill="white" font-size="14">Read Replicas</text>
  
  <!-- Analytics Queue -->
  <rect x="900" y="250" width="150" height="60" rx="5" fill="#9c27b0" />
  <text x="975" y="285" text-anchor="middle" fill="white" font-size="14">Message Queue</text>
  <text x="975" y="305" text-anchor="middle" fill="white" font-size="11">(Kafka)</text>
  
  <!-- Analytics Service -->
  <rect x="900" y="380" width="150" height="60" rx="5" fill="#673ab7" />
  <text x="975" y="415" text-anchor="middle" fill="white" font-size="14">Analytics Service</text>
  
  <!-- Object Storage -->
  <rect x="450" y="520" width="150" height="60" rx="5" fill="#ff9800" />
  <text x="525" y="555" text-anchor="middle" fill="white" font-size="14">Object Storage</text>
  <text x="525" y="575" text-anchor="middle" fill="white" font-size="11">(S3 - Archives)</text>
  
  <!-- Connections -->
  <!-- Client to CDN -->
  <line x1="170" y1="130" x2="250" y2="130" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  
  <!-- CDN to Load Balancer -->
  <line x1="370" y1="130" x2="450" y2="130" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  
  <!-- Load Balancer to API Gateway -->
  <line x1="570" y1="130" x2="650" y2="130" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  
  <!-- API Gateway to App Servers -->
  <line x1="710" y1="160" x2="410" y2="250" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  <line x1="710" y1="160" x2="560" y2="250" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  <line x1="710" y1="160" x2="710" y2="250" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  
  <!-- App Servers to Cache -->
  <line x1="410" y1="310" x2="325" y2="380" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  <line x1="560" y1="310" x2="325" y2="380" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  
  <!-- App Servers to Database -->
  <line x1="410" y1="310" x2="525" y2="380" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  <line x1="560" y1="310" x2="525" y2="380" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  <line x1="710" y1="310" x2="525" y2="380" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  
  <!-- App Servers to Read Replicas -->
  <line x1="710" y1="310" x2="725" y2="380" stroke="#333" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)" />
  
  <!-- App Servers to Message Queue -->
  <line x1="710" y1="280" x2="900" y2="280" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  
  <!-- Message Queue to Analytics -->
  <line x1="975" y1="310" x2="975" y2="380" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  
  <!-- Database to Object Storage -->
  <line x1="525" y1="440" x2="525" y2="520" stroke="#333" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)" />
  
  <!-- Arrow marker definition -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333" />
    </marker>
  </defs>
  
  <!-- Legend -->
  <g transform="translate(50, 650)">
    <text x="0" y="0" font-size="16" font-weight="bold" fill="#333">Legend:</text>
    <line x1="0" y1="20" x2="40" y2="20" stroke="#333" stroke-width="2" />
    <text x="50" y="25" font-size="12" fill="#666">Synchronous Request</text>
    
    <line x1="0" y1="40" x2="40" y2="40" stroke="#333" stroke-width="2" stroke-dasharray="5,5" />
    <text x="50" y="45" font-size="12" fill="#666">Asynchronous/Optional</text>
  </g>
  
  <!-- Flow annotations -->
  <text x="600" y="630" text-anchor="middle" font-size="14" fill="#666">Write Flow: Client → CDN → LB → API GW → App Server → Cache + DB</text>
  <text x="600" y="650" text-anchor="middle" font-size="14" fill="#666">Read Flow: Client → CDN (cache hit) or → App Server → Cache/DB</text>
  <text x="600" y="670" text-anchor="middle" font-size="14" fill="#666">Analytics: App Server → Kafka → Analytics Service (Async)</text>
</svg>